#!/bin/sh

#
# Copyright (C) 2022 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-2.0-only
#

if [ $# -lt 2 ]; then
    logger -t openvpn "Not enough script parameters"
    exit 3
fi

instance=$1
config=$2

instance_type=$(uci -q get openvpn.$instance)
if [ "$instance_type" = "openvpn" ]; then
    # This is a tunnel, skip the check
    exit 0
fi

uinstance=$(uci -q get openvpn.$common_name.instance)
if [ "$uinstance" != "$instance" ]; then
    exit 2
fi

enabled=$(uci -q get openvpn.$common_name.enabled)
if [ "$enabled" == "0" ]; then
    exit 1
fi
