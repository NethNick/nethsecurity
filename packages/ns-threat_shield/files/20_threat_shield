#!/bin/sh

crontab -l | grep -q '/etc/init.d/ts-ip' || echo '50 * * * * sleep $(( RANDOM % 3500 )); /etc/init.d/ts-ip reload' >> /etc/crontabs/root
crontab -l | grep -q '/etc/init.d/adblock' || echo '1 */12 * * * sleep $(( RANDOM % 3600 )); /etc/init.d/adblock reload' >> /etc/crontabs/root

if [ "$(uci -q get threat_shield.config.status)" = "" ]; then
    uci -q import threat_shield << EOI
config main 'config'
	option url ''
	option log_blocked '0'
	option status '0'
EOI
fi

if [ "$(uci -q get adblock.global.ts_enabled)" = "" ]; then
    uci set adblock.global.ts_enabled=0
fi
