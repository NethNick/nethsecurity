#!/bin/sh

#
# Copyright (C) 2022 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-2.0-only
#

#
# Threat shield: download remote blocklist
#

function exit_error {
    >&2 echo "[ERROR] $@"
    exit 1
}

SYSTEM_SECRET=$(uci -q get ns-plug.config.secret)
SYSTEM_ID=$(uci -q get ns-plug.config.system_id)

sources=/etc/banip/banip.nethesis.feeds

if [ ! -z "$SYSTEM_SECRET" ] && [ ! -z "$SYSTEM_ID" ]; then
    cat $sources | sed -e "s/__USER__/$SYSTEM_ID/" -e "s/__PASSWORD__/$SYSTEM_SECRET/" > /etc/banip/banip.custom.feeds
else
    > /etc/banip/banip.custom.feeds
fi
